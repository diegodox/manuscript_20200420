<div style="font-size:10px;">

> 原稿と対応する論文の箇所（読まない）

`コメント （読まない）`


# pmo 勉強会第二回原稿

```
これから論文読みを開始する旨を伝える．
あらましの部分は飛ばす旨を伝える．
```

## 1. 前書き

> 画像符号化は，大きく非可逆符号化と可逆符号化に分類できる.符号化前の画像と復号画像が完全に一致する……

画像の符号化には可逆符号化と非可逆符号化があります．

可逆符号化は符号化前の画像と復号後の画像が完全に一致します．つまり，データの欠損がありません．  
一方で，非可逆符号化は一部のデータを省略、改変などして画像の圧縮率をあげます．  
とくに高周波成分など、人間の視覚的には知覚しにくいデータを捨てます．

画質劣化が許容されるのであれば，記憶装置の容量的観点から，圧縮率が高い非可逆符号化を用います．  
逆に，例えば医療用の画像など，画質劣化が許容されない画像は可逆符号化を用います．

この事例ベースの研究は可逆符号化です．なので符号前，復号後の画像が完全に一致していなければなりません．

----------------------------------------------------------------------------------------------------------------

> 現在の画像符号化技術の中で主流となっている手法は，相関除去とエントロピー符号化の二つのステージで……

近年の画像符号化の主流の方法には相関除去とエントロピー符号化の二つの段階があります．  
以下の内容は事例ベースの方法ではない可逆符号化の方法です．

`適応予測には触れない（事例ベースとの直接的な関わりが無いから）`

相関除去とは画像信号の冗長性を除去することです．  
入力画素値と予測値の差分である予測残差は，予測がうまくいけば（精度の高い予測器を作れれば） $0$ 付近の値になるので，  
画像の画素値ではなくこの予測残差を用いることで， $0$ 付近の値の集合を符号化対象とすることができます．  

エントロピー符号化はこの相関除去後 $0$ 付近の値の集合を対象とします．  
この相関除去後の信号は左右対称かつ $0$ 付近に単一のピークをもつ確率分布になると期待できます．  
確率分布が急峻になるほど，エントロピーは減少するので，したがってエントロピー符号化した全体の符号量も減り圧縮率が上がります．  
つまり，（事例ベースでない）一般的な可逆符号化は精度の高い予測器を作ることによって画像の圧縮率をあげることができるのです．  
精度の高い予測器を設計する際には最小二乗法，重み付き最小二乗法が一般的に用いられます．

----------------------------------------------------------------------------------------------------------------

> これらの手法に対し，筆者らは相関除去の処理を経ていない輝度値の確率分布を推定し……

`事例ベースの説明に入る旨を伝える`

事例ベースでは相関除去は用いず確率分布を推定し，直接エントロピー符号化をする方法です．  
相関除去により得られる予測残差は全ての画素に一対一の対応をもつ $0$ 付近の値で，  
先ほどの一般的な可逆符号化方法ではこの予測残差の値の出現頻度から確率分布を作りました．  
この確率分布は $0$ 付近にただ一つのピークをもつ確率分布であり，画像に対し一つの確率分布でした．

これ対して，事例ベースでは複数のピークをもつ確率分布を，画像の各画素について求めます．  
この画素ごとの確率分布は，符号化対象画素の非近傍の符号化済み領域からテンプレートマッチングで収集した事例を元に作ります．  
この確率分布を元にして，画素ごとにエントロピー符号化をしていきます．  
また，事例の定義は符号化対象画素と周辺の輝度分布が類似している画素のことです．

`テンプレートの例の画像を参照してもらう`

また，分布の形状を制御するパラメータが画像の $64 \times 64$ 画素のブロックごとに $4$ つずつあります．  
ブロックごとに発生する符号量が最小になるように準ニュートン法でパラメータを決定します．  
これにより複合側に伝送する符号化効率を高めることができます．

----------------------------------------------------------------------------------------------------------------

> 複数のピークをもつ確率分布を用いるという観点で，類似する手法が……

近傍画素のみでなく，非近傍の符号化済み領域の値からも予測値を得る点が，事例ベースの新規性でもあります．

----------------------------------------------------------------------------------------------------------------

> 本論文では，上記の事例探索に基づく手法をベースに……

`適応予測は事例ベースとの直接的な関わりがないのでここは省略`

----------------------------------------------------------------------------------------------------------------

> 本論文の構成は以下のとおりである.まず……

今回の勉強会では2章の事例探索と確率モデルの最適化に基づく可逆符号化方式という部分のみを説明します．




## 2. 事例探索と確率モデルの最適化に基づく可逆符号化方式

```
事例ベースの説明に入る
補足資料2を確認してもらう
```

### 2.1 事例探索

> 提案手法では，非近傍領域の情報を利用するために……

事例探索では事例を既に符号化した領域から探します．  
画像の符号化・複合化はラスタスキャン順，つまり画像の左上から右下に横向きに行うので，  
符号化済み領域とは図(1)のように符号化対象画素より上の行の画素と同じ行の左側の画素となります．  

テンプレートとは図(2)のような符号化対象画素とその近傍画素の集まりです．  
周辺輝度分布が近いパターンを符号化済み領域から探索することをテンプレートマッチングと呼びます．  
周辺輝度分布ほぼ同じなら，符号化対象画素 $\bm p_k$ の輝度値はその画素 $\bm q_{k, m}$ の輝度値とほぼ同じと推定できます．

また，テンプレートマッチングの探索領域は既に符号化した領域すべてでなく，探索窓というある程度近傍の領域です．  
探索窓の大きさは $S$ という値で制御され，この論文では $S=80$ とされています．

太字の変数 $\bm p_k, \bm q_{k, m}$ などは位置ベクトルで，画素の座標を表していて．  
一方， $\bm r_i$ はテンプレート内での $\bm p_k, \bm q_{k, m}$ に対する相対座標を表しています．  
図(2)のテンプレート符号化済み領域のうち， $\bm p_k$ との市街地地距離が $\Vert \bm r_i \Vert_1 \le 3$ を満たす12画素の集まりです．

----------------------------------------------------------------------------------------------------------------

> 探索領域内の全ての画素 $\bm q \in \mathbb{Z}^2$ について，周辺輝度分布と……

周辺輝度分布の類似度は式(1)のコスト関数により定量的に表せます．  
コスト関数の値が小さいほど周辺輝度分布の類似度が高いと考えられます．

$$
J_k (\bm{q}) = \left[ \sum_{i = 1}^{12} w_i \cdot \left(
f( \bm{q} + \bm{r}_i ) - \mu(\bm{q}) - f(\bm{p}_k + \bm{r}_i ) + \mu(\bm{p}_k)
\right)^2 \right]^{\dfrac{1}{2}} + \lambda_d \cdot \Vert \bm{q} - \bm{p}_k \Vert_1 \tag{1}
$$

ここで， $f(\bm q)$ は画素 $\bm q$ の輝度値， $\mu(\bm q)$ は式(2)で示される重み付き平均です．

$$
\mu(\bm{q}) = \sum_{i = 1}^{12} w_i \cdot f(\bm{q} + \bm{r}_i) \tag{2}
$$

さらに $w_i$ は $\sigma_t = 1.25$ のガウス関数で定義された重み係数です．

$$
w_i = \dfrac{
\exp\left( -\dfrac{1}{2} \Vert \bm{r}_i \Vert_1^2 / \sigma_t^2 \right)
}{
\sum_{l = 2}^{12}\exp\left( -\dfrac{1}{2} \Vert \bm{r}_l \Vert_1^2 / \sigma_t^2 \right)
} \tag{3}
$$

式(1)の右辺第一項の $f(\bm q + \bm r_i) - \mu(\bm q)$ は画素 $\bm q + \bm r_i$ の輝度値がテンプレート内の平均の輝度値とどれだけ離れているかを示しています．  
同様に， $f(\bm p_k + \bm r_i) - \mu(\bm p_k)$ についても $\bm p_k + \bm r_i$ の輝度値がテンプレート内の平均の輝度値とどれだけ離れているかを示しています．  
これらの差分の二乗が小さいほど画素 $\bm p_k + \bm r_i$ は画素 $\bm q + \bm r_i$ と近い周辺輝度分布の画素だと言えます．  
これを $i = 1,\dots,12$ としてテンプレート内の全画素について差分を計算し，重みをつけて足し合わせ，その平方根を撮ったものが右辺第一項です．  
よって右辺第一項は周辺輝度分布の類似度の指標となります．

式(1)の右辺第二項は画像信号の空間的連続を考慮したペナルティー項です．  
$\lambda_d$ は定数でこの値は先行実験の結果で決定されています．  
$\bm q - \bm p_k$ は参照画素と符号化対象画素の差であるので，遠くの画素を推定値として用いると大きくなります．  
よって，推定値として用いる画素が遠ければ遠いほどコスト関数は大きくなります．  
右辺第二項は画像には多くの場合空間的連続性があるので，それを考慮するための項です．

式(3)は分母が定数であるため， $w_i$ は $\bm r_i$ の関数です．  
$\bm r_i$ が大きくなるほど分子は小さくなるため， $w_i$ テンプレート内で市街地距離が近いほど大きくなります．  
式(1)では，市街地距離が近いものの類似度を優遇するための係数となっています．  
式(2)では，市街地距離が近いものの値を強調するための係数となっています．

----------------------------------------------------------------------------------------------------------------

> 以上のテンプレートマッチングを各画素について実行し……

このコスト関数 $J_k(\bm q)$ の値順に $M$ 画素を抽出しての事例の集合 $E_k = \{ \bm q_{k, 1}, \bm q_{k, 2}, \dots, \bm q_{k, M} \}$とします．  
$E_k$ より $M$ 種類の符号化対象画素の式(4)で表される推定値 $f_{k,m}$ を得ることができます．

$$
f_{k, m} = f(\bm{q}_{k, m}) - \mu(\bm{q}_{k, m}) + \mu(\bm{p}_{k}) \qquad ( m = 1, 2, \dots, M ) \tag{4}
$$

この推定値を用いて確率分布を得て算術符号化を行います．
